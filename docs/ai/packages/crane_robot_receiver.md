# crane_robot_receiver

## 概要

ロボットからの**状態受信とフィードバック処理**を担うパッケージです。実機ロボットやシミュレータからの診断情報、状態データ、エラー情報を受信し、システム全体の監視・診断機能を提供します。

## 主要機能

- **ロボット診断情報処理**: DiagnosticPublisherによる健全性監視
- **Ping状態監視**: ロボット接続状況の監視
- **エラー検出・報告**: RobotErrors処理とアラート
- **フィードバック統合**: 制御系へのフィードバック情報提供

## コンポーネント

- **DiagnosticPublisher**: システム診断情報の配信
- **RobotStatusNode**: ロボット状態監視
- **PingStatusNode**: 通信状態監視

## アーキテクチャ上の役割

Craneシステムの**フィードバック制御基盤**として、ロボットからの状態情報を上位制御系に提供し、システム全体の健全性を監視します。

## 診断機能

このパッケージは各ロボット（ID 0-12）について3種類の診断情報を提供します：

### 提供する診断項目

1. **通信状態監視** (`robot_{:02d}/communication`)
   - Ping応答時間の監視
   - 閾値: >50ms→ERROR、>10ms→WARN
   - シミュレータモード対応

2. **バッテリー監視** (`robot_{:02d}/battery`)
   - バッテリー電圧の監視
   - 閾値: <22.0V→ERROR、<23.0V→WARN

3. **ロボットエラー監視** (`robot_{:02d}/robot_error`)
   - POWERエラー（14種類）の検出
   - BLDCモーターエラー（4モーター×7種類）の検出
   - エラー継続時間とエラー値の報告

### 特徴的な機能

- **エラーマップ管理**: 複数のエラーを同時追跡し、10秒でタイムアウト
- **Foxglove可視化**: ロボット位置にエラーメッセージを表示
- **シミュレータ対応**: `sim_mode`パラメータで動作切り替え

詳細は[診断システムドキュメント](../diagnostics.md#crane_robot_receiverdiagnosticpublisher)を参照してください。

## 最近の開発状況

🟢 **安定**: フィードバックシステムとして成熟しており、新しい診断機能の追加や監視精度の向上が継続的に行われています。

---

**関連パッケージ**: [crane_sender](./crane_sender.md) | [crane_world_model_publisher](./crane_world_model_publisher.md)
