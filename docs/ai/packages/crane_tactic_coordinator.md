# crane_tactic_coordinator

## æ¦‚è¦

**crane_tactic_coordinator**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€Crane SSLãƒ­ãƒœãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã®**æœ€ä¸Šä½åˆ¶å¾¡ãƒ¬ã‚¤ãƒ¤ãƒ¼**ã¨ã—ã¦ã€åŒ…æ‹¬çš„ãªè©¦åˆç®¡ç†ã¨ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆ¶å¾¡ã‚’æä¾›ã—ã¾ã™ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒœãƒƒãƒˆå½¹å‰²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã€å‹•çš„ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†ã¨YAMLé§†å‹•è¨­å®šã‚’é€šã˜ã¦SSLè©¦åˆä¸­ã®è¤‡æ•°ãƒ­ãƒœãƒƒãƒˆã‚’å”èª¿åˆ¶å¾¡ã—ã¾ã™ã€‚æŸ”è»Ÿã§è¨­å®šé§†å‹•ãªãƒ­ãƒœãƒƒãƒˆå½¹å‰²ç®¡ç†ã«ã‚ˆã‚Šã€SSLè©¦åˆã§ã®æ´—ç·´ã•ã‚ŒãŸãƒãƒ«ãƒãƒ­ãƒœãƒƒãƒˆå”èª¿ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ä¸»è¦æ©Ÿèƒ½

- **è©¦åˆçµ±æ‹¬åˆ¶å¾¡**: SSLè©¦åˆå…¨ä½“ã®ãƒ•ãƒ­ãƒ¼ç®¡ç†
- **ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†**: çŠ¶æ³ã«å¿œã˜ãŸæˆ¦ç•¥ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã®é¸æŠãƒ»åˆ‡ã‚Šæ›¿ãˆ
- **ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†**: Refereeä¿¡å·ã«åŸºã¥ãçŠ¶æ…‹é·ç§»åˆ¶å¾¡
- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†**: è©¦åˆçŠ¶æ³ã®å±¥æ­´ãƒ»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿æŒ
- **YAMLè¨­å®šé§†å‹•**: æŸ”è»ŸãªçŠ¶æ³å¯¾å¿œè¨­å®š

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä¸Šã®å½¹å‰²

Craneã‚·ã‚¹ãƒ†ãƒ ã®**æœ€ä¸Šä½åˆ¶å¾¡å±¤**ã¨ã—ã¦ã€SSL Refereeã‹ã‚‰ã®æŒ‡ç¤ºã‚’è§£é‡ˆã—ã€é©åˆ‡ãªæˆ¦ç•¥ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã‚’é¸æŠãƒ»å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€è©¦åˆå…¨ä½“ã‚’çµ±æ‹¬ã—ã¾ã™ã€‚ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€æ§˜ã€…ãªæˆ¦è¡“ã‚’çŠ¶æ³ã«å¿œã˜ã¦å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

### TacticCoordinatorï¼ˆãƒ¡ã‚¤ãƒ³åˆ¶å¾¡ï¼‰

- **çŠ¶æ…‹ç®¡ç†**: SSL RefereeçŠ¶æ…‹ã®è¿½è·¡ã¨å¯¾å¿œ
- **ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼é¸æŠ**: çŠ¶æ³ã«å¿œã˜ãŸæœ€é©ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã®é¸æŠ
- **å®Ÿè¡Œåˆ¶å¾¡**: é¸æŠã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã®å®Ÿè¡Œç®¡ç†
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ç•°å¸¸çŠ¶æ³ã§ã®å®‰å…¨ãªå‹•ä½œ

## çµ±ä¸€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆunified_session_config.yamlï¼‰

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `session/crane_tactic_coordinator/config/unified_session_config.yaml`

ã™ã¹ã¦ã®è©¦åˆçŠ¶æ³è¨­å®šãŒå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã«çµ±åˆã•ã‚Œã¦ã„ã¾ã™ã€‚å„çŠ¶æ³ï¼ˆsituationï¼‰ã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆsessionï¼‰ã®ãƒªã‚¹ãƒˆã¨ã—ã¦å®šç¾©ã•ã‚Œã€å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ­ãƒœãƒƒãƒˆãŒå‹•çš„ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚

### è¨­å®šæ§‹é€ 

```yaml
situations:
  HALT:
    description: è©¦åˆåœæ­¢
    sessions: []
  INPLAY:
    description: é€šå¸¸ãƒ—ãƒ¬ã‚¤
    sessions:
      - name: attacker_skill
        capacity: 1
      - name: total_defense
        capacity: 3
      # ...
  OUR_FREE_KICK:
    description: è‡ªãƒãƒ¼ãƒ ãƒ•ãƒªãƒ¼ã‚­ãƒƒã‚¯
    sessions:
      - name: attacker_skill
      - name: total_defense
      # ...
```

### ä¸»è¦ãªè©¦åˆçŠ¶æ³

- **HALT**: è©¦åˆåœæ­¢ï¼ˆãƒ­ãƒœãƒƒãƒˆç„¡å‹•ä½œï¼‰
- **STOP**: ä¸€æ™‚åœæ­¢
- **INPLAY**: é€šå¸¸ãƒ—ãƒ¬ã‚¤
- **OUR_KICKOFF_START / OUR_KICKOFF_PREPARATION**: è‡ªãƒãƒ¼ãƒ ã‚­ãƒƒã‚¯ã‚ªãƒ•
- **OUR_FREE_KICK**: è‡ªãƒãƒ¼ãƒ ãƒ•ãƒªãƒ¼ã‚­ãƒƒã‚¯
- **OUR_PENALTY_KICK**: è‡ªãƒãƒ¼ãƒ ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚­ãƒƒã‚¯
- **OUR_BALL_PLACEMENT**: è‡ªãƒãƒ¼ãƒ ãƒœãƒ¼ãƒ«é…ç½®
- **THEIR_***: æ•µãƒãƒ¼ãƒ å¯¾å¿œçŠ¶æ³

## å‹•ä½œãƒ•ãƒ­ãƒ¼

### çŠ¶æ³åˆ¤å®šâ†’ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼é¸æŠ

```cpp
void TacticCoordinator::update() {
  // 1. ç¾åœ¨çŠ¶æ³ã®åˆ†æ
  auto situation = analyzeCurrent Situation();

  // 2. é©åˆ‡ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®é¸æŠ
  auto config = loadSituationConfig(situation);

  // 3. ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã®é¸æŠãƒ»åˆ‡ã‚Šæ›¿ãˆ
  auto planner = selectOptimalPlanner(config);

  // 4. ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã®å®Ÿè¡Œ
  planner->plan(context_);

  // 5. çµæœã®çµ±åˆãƒ»é…ä¿¡
  publishRobotCommands();
}
```

### çµ±ä¸€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

```yaml
# unified_session_config.yamlï¼ˆæŠœç²‹ï¼‰
situations:
  OUR_FREE_KICK:
    description: OUR_FREE_KICK
    sessions:
      - name: total_defense
        capacity: 3
      - name: attacker_skill
        capacity: 1
      - name: pass_receive
        capacity: 1
      - name: forward
        capacity: 20
  timeout: 10.0       # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“
```

## ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ç®¡ç†

```cpp
class TacticCoordinator {
private:
  std::map<std::string, std::shared_ptr<TacticBase>> planners_;
  std::string current_planner_name_;

public:
  void switchPlanner(const std::string& planner_name) {
    if (planners_.count(planner_name)) {
      current_planner_ = planners_[planner_name];
      current_planner_->reset();
    }
  }
};
```

### å‹•çš„ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼é¸æŠ

```cpp
std::string selectOptimalPlanner(const GameSituation& situation) {
  if (situation.is_freekick) {
    return situation.our_freekick ? "FreekickOffensePlanner" : "FreekickDefensePlanner";
  } else if (situation.is_penalty) {
    return situation.our_penalty ? "PenaltyOffensePlanner" : "PenaltyDefensePlanner";
  } else {
    return "InplayTactic";
  }
}
```

## ä¾å­˜é–¢ä¿‚

### ã‚³ã‚¢ä¾å­˜

- **crane_tactics**: å®Ÿéš›ã®æˆ¦ç•¥ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ç¾¤
- **crane_msg_wrappers**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¤‰æ›ãƒ»çµ±åˆ
- **crane_msgs**: ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®šç¾©

### æ©Ÿèƒ½ä¾å­˜

- **yaml-cpp**: YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
- **diagnostic_updater**: ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­
- **closest_point_vendor**: å¹¾ä½•å­¦è¨ˆç®—æ”¯æ´

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬èµ·å‹•

```bash
# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼èµ·å‹•
ros2 run crane_tactic_coordinator crane_tactic_coordinator_node

# ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“èµ·å‹•ï¼ˆå«ã‚€ï¼‰
ros2 launch crane_bringup crane.launch.xml
```

### ã‚«ã‚¹ã‚¿ãƒ è¨­å®š

```yaml
# config/custom_situation.yaml
situation: "CUSTOM_DEFENSE"
robots:
  - id: 0
    role: "goalie"
    planner: "GoalieTactic"
  - id: [1,2,3]
    role: "defender"
    planner: "DefenseTactic"
```

## è¨ºæ–­æ©Ÿèƒ½

ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯AIè¨ˆç”»ã‚µã‚¤ã‚¯ãƒ«ã®å¥å…¨æ€§ã‚’ç›£è¦–ã™ã‚‹è¨ºæ–­æƒ…å ±ã‚’æä¾›ã—ã¾ã™ï¼š

### æä¾›ã™ã‚‹è¨ºæ–­é …ç›®

- **AIè¨ˆç”»ã‚µã‚¤ã‚¯ãƒ«çŠ¶æ…‹** (`ai_planner/planning_cycle`)
  - WorldModelã®æº–å‚™çŠ¶æ…‹
  - è¨ˆç”»ã‚µã‚¤ã‚¯ãƒ«ã®æ›´æ–°é »åº¦

### è¨ºæ–­ãƒ¬ãƒ™ãƒ«

- **ERROR**: 1ç§’ä»¥ä¸Šè¨ˆç”»ã‚µã‚¤ã‚¯ãƒ«æœªå®Ÿè¡Œ
- **WARN**: WorldModelæœªæº–å‚™ã€ã¾ãŸã¯500msä»¥ä¸Šæ›´æ–°é…å»¶
- **OK**: æ­£å¸¸å‹•ä½œä¸­ï¼ˆæ›´æ–°æ™‚é–“ã‚‚å ±å‘Šï¼‰

è©³ç´°ã¯[è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](../diagnostics.md#crane_tactic_coordinator)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## æœ€è¿‘ã®é–‹ç™ºçŠ¶æ³

### 2025å¹´ã®ä¸»è¦å¤‰æ›´

- **ã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•å¾©å¸°**: é€”ä¸­å†èµ·å‹•æ™‚ã®ãƒ­ãƒ¼ãƒ«å†å‰²å½“ãƒ•ãƒ­ãƒ¼ã‚’æ•´å‚™
- **ãƒ—ãƒ¬ã‚¤ãƒãƒ³ãƒ‰ãƒ«åŒ–**: ã‚­ãƒƒã‚¯ç³»ã‚·ãƒŠãƒªã‚ªã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµ±ä¸€
- **çŠ¶æ³åˆ¤å®šç²¾åº¦å‘ä¸Š**: Referee+Analyzerè¤‡åˆåˆ¤å®šã®é–¾å€¤å†èª¿æ•´
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚’ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°åŒ–

### é–‹ç™ºæ´»ç™ºåº¦

ğŸŸ¡ **ä¸­æ´»å‹•**: è©¦åˆè¦å‰‡å¤‰æ›´ã‚„æ–°ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ã«ä¼´ã†è¨­å®šæ›´æ–°ãŒç¶™ç¶šä¸­ã€‚ç‰¹ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚ŒãŸYAMLã‚·ãƒŠãƒªã‚ªã¨ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼é€£æºã®æ”¹ä¿®ãŒæ´»ç™ºã€‚

### æŠ€è¡“çš„ç‰¹å¾´

- **è¨­å®šé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ã‚³ãƒ¼ãƒ‰å¤‰æ›´ãªã—ã§ã®æˆ¦è¡“èª¿æ•´
- **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµ±åˆ**: å‹•çš„ãªãƒ—ãƒ©ãƒ³ãƒŠãƒ¼é¸æŠãƒ»åˆ‡ã‚Šæ›¿ãˆ
- **çŠ¶æ³é©å¿œ**: SSLè¦å‰‡å¤‰æ›´ã¸ã®æŸ”è»Ÿãªå¯¾å¿œ

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç‰¹æ€§

### å¿œç­”æ€§èƒ½

- **çŠ¶æ³åˆ¤å®šæ™‚é–“**: <5ms
- **ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼åˆ‡ã‚Šæ›¿ãˆ**: <10ms
- **å…¨ä½“åˆ¶å¾¡å‘¨æœŸ**: 60Hzå¯¾å¿œ

### ç®¡ç†å®¹é‡

- **åŒæ™‚ç®¡ç†ãƒ­ãƒœãƒƒãƒˆ**: æœ€å¤§11å°
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: 25ç¨®é¡ã®çŠ¶æ³å¯¾å¿œ
- **ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ç¨®é¡**: 20ç¨®é¡ä»¥ä¸Š

## å°†æ¥å±•æœ›

### æŠ€è¡“ç™ºå±•

- **AIçµ±åˆ**: æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹çŠ¶æ³åˆ¤å®šã®é«˜åº¦åŒ–
- **é©å¿œåˆ¶å¾¡**: å¯¾æˆ¦ç›¸æ‰‹ã«å¿œã˜ãŸå‹•çš„æˆ¦è¡“èª¿æ•´
- **äºˆæ¸¬åˆ¶å¾¡**: ã‚ˆã‚Šé•·æœŸçš„ãªæˆ¦ç•¥è¨ˆç”»

---

**é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: [crane_tactics](./crane_tactics.md) | [crane_play_switcher](./crane_play_switcher.md) | [crane_robot_skills](./crane_robot_skills.md)
