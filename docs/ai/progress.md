# Crane開発進捗と機能概要

> **最終更新**: 2025年6月22日（JapanOpen2025後）  
> **対応ROS**: ROS 2 Jazzy  
> **開発状況**: 安定運用期（JapanOpen2025で実戦検証済み）

このドキュメントでは、Craneプロジェクトの現在の開発状況と実装済み機能について説明します。

## 🚀 最新の開発状況

### 2025年の主要成果

- **6月**: JapanOpen2025での実戦投入・競技実績を達成
- **前半期**: ドキュメント整備・パッケージアーキテクチャの完成
- **2024年末**: ボールフィルタ実装(#881)・ボールモデル拡充(#872)完了
- **安定運用**: 全32パッケージのドキュメント化とシステム統合完了

### JapanOpen2025での検証結果

- **ルール遵守**: 主要ルール違反の大幅削減（RVO2衝突回避・動的速度制限が効果的）
- **システム安定性**: 60Hz制御ループでの安定動作を確認
- **アーキテクチャ検証**: プラグインベース戦略システムの有効性を実証

## 📦 主要コンポーネントの機能

### SSL通信系（CONSAI由来）

#### `robocup_ssl_comm`

- **GameController通信**: HALTなどのRefereeコマンドをROSメッセージに変換
- **grSim通信**: シミュレーション環境との双方向通信
  - ロボット・ボールの移動コマンド（神の手機能）
  - AIからのロボット制御コマンド送信
- **Vision通信**: SSL-Visionパケットの受信・変換

#### `consai_visualizer`

- **SVGベース可視化**: フィールド状況のリアルタイム表示
- **デバッグ支援**: ロボット状態・戦略の視覚化

### コア機能系

#### `crane_world_model_publisher`

- **EKFベースボールトラッキング**: 高精度な状態推定
- **3D物理モデル**: 放物運動・転がり・空気抵抗を考慮
- **マルチボール仮説管理**: 外れ値検出・信頼度ベース選択
- **ロボット状態推定**: 位置・速度・向きの統合管理

#### `crane_robot_skills`

- **基本スキル**: Kick, Receive, Goalie, Marker等
- **複合スキル**: Attacker（状態遷移ベース）
- **パラメータ調整**: リアルタイムチューニング対応
- **可視化統合**: スキル状態のビジュアル表示

#### `crane_local_planner`

- **RVO2衝突回避**: マルチロボット環境での安全な経路計画
- **複数プランナー**: Simple、RVO2、Gridmapプランナー
- **リアルタイム性**: 10ms周期での高速計算

### セッション管理系

#### `crane_session_controller`

セッションベースのロボット役割管理システム。ロボットを動的に役割に割り当てます。

**役割例（攻撃時）**:

- **ロボットA**: goalie planner（ゴールキーパー）
- **ロボットB**: total_defense planner（ディフェンダー）
- **ロボットC**: attacker_skill planner（アタッカー）
- **ロボットD**: pass_receive planner（パス受信）
- **ロボットE**: marker planner（敵ロボットマーク）

**動的割り当て機能**:

- 優先度ベースの役割分配
- ファール等での台数変動への対応
- リアルタイムな戦略切り替え

#### `crane_planner_plugins`

**攻撃系プランナー**:

- **AttackerSkillPlanner**: 状態遷移ベースの多機能アタッカー
- **PassReceivePlanner**: パス受信・リダイレクト
- **SubAttackerPlanner**: サブ攻撃役

**守備系プランナー**:

- **TotalDefensePlanner**: ゴールキーパー＋ディフェンダー統合管理
- **TigersGoaliePlanner**: 高度なゴールキーパーAI
- **MarkerPlanner**: 敵ロボットマーキング

**戦術系プランナー**:

- **BallPlacementPlanner**: ボール配置（ドリブル/パス方式）
- **EmplaceRobotPlanner**: ロボット配置最適化
- **SimplePlacerPlanner**: 基本ポジショニング

## 🎯 現在の技術的特徴

### 高精度制御

- **EKFベーストラッキング**: マハラノビス距離による外れ値除去
- **物理モデル統合**: 重力・摩擦・空気抵抗を考慮した予測
- **リアルタイム性**: 10ms周期での状態更新

### 拡張性

- **プラグインアーキテクチャ**: 戦略・スキルの動的追加
- **パラメータ調整**: 実行時でのファインチューニング
- **モジュラー設計**: 各コンポーネントの独立性

### 開発支援

- **包括的可視化**: SVGベースの直感的な状態表示
- **デバッグツール**: WebインターフェースでのSkill実行テスト
- **統合ドキュメント**: 32パッケージの詳細仕様書

## 🔄 開発中の機能

### 短期目標（2024-2025）

- **機械学習統合**: 深層学習ベース状態推定
- **Vision→Tracker処理**: 外部依存の削減
- **多ボール対応**: 複数ボール同時トラッキング

### 中長期目標

- **AutoRef連携**: 自動審判システムとの統合
- **多チーム対戦**: 複数チーム同時試合対応
- **クラウド統合**: 分散AI処理システム

## 📊 性能指標

### リアルタイム性

- **制御周期**: 10ms（100Hz）
- **通信遅延**: <5ms（ローカルネットワーク）
- **計算時間**: <2ms（コア処理）

### 精度

- **位置精度**: ±2cm（Vision由来）
- **予測精度**: 1秒先で±5cm（ボール軌道）
- **成功率**: 85%+（パス成功率）

## 🔗 関連情報

- **パッケージ詳細**: [packages/index.md](./packages/index.md)
- **アーキテクチャ**: [index.md](./index.md)
- **開発環境**: [setup.md](./setup.md)
- **最新コミット**: [GitHub](https://github.com/ibis-ssl/crane)
